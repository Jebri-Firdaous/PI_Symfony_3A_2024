{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block section6 %}


 <!-- Page Title -->
    <div class="page-title" data-aos="fade">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1>Réservez Votre Billet</h1>
              
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="index.html.twig">Acceuil</a></li>
            <li class="current">Transport</li>
          </ol>
        </div>
      </nav>
    </div><!-- End Page Title -->
<button id="afficherListeBillets" class="category btn-afficher">Afficher la liste des billets réservés</button>

   <!-- Courses List Section -->
 <section id="courses-list" class="section courses-list">
  <div class="container">
    <div class="row row-cols-1 row-cols-md-3 g-4">
      {% for billet in list %}
      
      <div class="col" data-aos="zoom-in" data-aos-delay="100">
        <div class="course-item h-100">
          <div class="course-content">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <p class="dest">{{ billet.destinationVoyage }}</p>
              <p class="price">{{ billet.prix }} DT</p>
            </div>
             <h3 data-nom-station="{{ billet.station.nomStation }}" data-adresse-station="{{ billet.station.adressStation }}" data-type-station="{{ billet.station.type }}"></h3>
            <p class="description">{{ billet.dateDepart|date('Y-m-d H:i:s') }}</p>
            <div class="trainer d-flex justify-content-between align-items-center">
              <div class="trainer-profile d-flex align-items-center">
                <a href="" class="trainer-link">Durée : {{ billet.duree }}</a>
              </div>
              <div class="trainer-rank d-flex align-items-center">
                 <a href="#" id="reservation-button"  class="category btn-reserver">Réserver</a>
                <a href="#" id="cancel-button" class="category btn-annuler" style="display: none;">Annuler</a>
                <i  id="numberOfReservations" class="bi bi-person user-icon">&nbsp;0</i>
                &nbsp;&nbsp;
            
              </div>
            </div>
          </div>
        </div>
      </div> <!-- End Course Item-->

      {% endfor %}
    </div>
  </div>
 
</section>
<ul  id="listeBilletsReservesUl">
   <table border="1" id="listeBilletsReservesTable" >
    <thead>
        <tr>
            <th>Destination</th>
            <th>Date de départ</th>
            <th>Prix</th>
            <th>Durée</th>
            <th>Station</th>
            <th>Annuler Votre Réservation</th>
        </tr>
    </thead>
    <tbody id="listeBilletsReserves">
        <!-- Les billets réservés seront ajoutés dynamiquement ici -->
    </tbody>
</table>
</ul><!-- /Courses List Section -->
<!-- /Courses List Section -->

{# <div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="form-wrapper"> <!-- Ajout du wrapper pour le formulaire -->
                <h2 style="text-align: center;">Réservez votre Billet</h2> <!-- Ajout du titre du formulaire à l'intérieur du wrapper -->
                {{ form_start(f, {'attr': {'class': 'form', 'novalidate': 'novalidate'}}) }}
                <div class="form-group">
                    {{ form_label(f.destinationVoyage, 'Destination du voyage', {'label_attr': {'class': 'vendor/bootstrap/css/control-label label-blue'}}) }}
                    <br> <!-- Ajout d'un saut de ligne -->
                    {{ form_widget(f.destinationVoyage, {'attr': {'class': 'vendor/bootstrap/css/form-control col-sm-4'}}) }}
                    {{ form_errors(f.destinationVoyage)}}
                </div>
                <div class="form-group">
                    {{ form_label(f.dateDepart, 'Date de départ', {'label_attr': {'class': 'control-label label-blue'}}) }}
                    <br> <!-- Ajout d'un saut de ligne -->
                    {{ form_widget(f.dateDepart, {'attr': {'class': 'vendor/bootstrap/css/form-control col-sm-4'}}) }}
                </div>
                <div class="form-group">
                    {{ form_label(f.station, 'Station', {'label_attr': {'class': 'control-label label-blue'}}) }}
                    <br> <!-- Ajout d'un saut de ligne -->
                    {{ form_widget(f.station, {'attr': {'class': 'vendor/bootstrap/css/form-control col-sm-4'}}) }}
                </div>
                <button type="submit" >Enregistrer</button>
                {{ form_end(f) }}
            </div>
        </div>
    </div>
</div> #}
<!-- Modal de suppression -->
<div class="modal" tabindex="-1" role="dialog" id="deleteModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmation de suppression</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer ce billet ? Cette action est irréversible.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-black" data-dismiss="modal" id="annuler">Annuler</button>
                <a href="#" class="btn-black" id="confirmDelete">Supprimer</a>
            </div>
        </div>
    </div>
</div>
{# <div class="container pt-5">
    <div class="row justify-content-center">
        <div class="col-12 text-center">
            <h1 class="pb-4">Vos <i class='uil uil-bus color-yellow'></i> Billets</h1>
            <div class="d-flex justify-content-between">
                {% for billet in list %}
                <div class="ticket-option">
                    <input class="checkbox-ticket" type="radio" name="ticket" id="ticket-{{ loop.index }}">
                    <label for="ticket-{{ loop.index }}">
                        <span class="top-dots">
                            <span class="section dots"></span>
                        </span>
                           <span class="duration">{{ billet.destinationVoyage }}</span>
                         <span class="time mt-2">{{ billet.dateDepart|date('Y-m-d H:i:s') }}</span>
                        <span class="price mt-2 pb-4 mb-3"><sup>DT</sup>{{ billet.prix }}</span>
                        <span class="section dots"></span>
                        <span class="section pt-4"><i class='uil uil-clock-two mt-3'></i></span>
                        <span class="duration">{{ billet.duree }}</span>
                         <span class="section dots"></span>
                        <span class="section pt-4"><i class='uil uil-clock-two mt-3'></i></span>
                        <span class="duration">{{ billet.station.nomStation }} - {{ billet.station.adressStation }} - {{ billet.station.type }}</span>
                       
                        <span class="bottom-dots"><span class="section dots"></span></span>
                    </label> #}
                      {# <div class="mt-3">
                        <a href="{{ path('edit_billet',{id: billet.refVoyage}) }}" class="modifier btn btn-btn-secondary btn-sm mr-2">Modifier</a>
                        <a href="#" class="supprimer btn btn-btn-secondary btn-sm" onclick="$('#deleteModal').modal('show'); $('#confirmDelete').attr('href', '{{ path('delete_billet', {id: billet.refVoyage}) }}'); return false;">Supprimer</a>
                    </div> #}
                {# </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div> #}


{# <!-- Tableau des billets -->
<table border="3">
    <thead>
        <tr>
            <th style="border-bottom: 3px solid black;border-right: 3px solid black; ">Destination</th>
            <th style="border-bottom: 3px solid black;border-right: 3px solid black;">Date de départ</th>
            <th style="border-bottom: 3px solid black;border-right: 3px solid black;">Prix</th>
            <th style="border-bottom: 3px solid black;border-right: 3px solid black;">Durée</th>
            <th style="border-bottom: 3px solid black;border-right: 3px solid black;">Station</th>
            <th style="border-bottom: 3px solid black;border-right: 3px solid black;">Actions</th> <!-- Nouvelle colonne pour les actions -->
        </tr>
    </thead>
    <tbody>
        {% for billet in list %}
            <tr style="border-bottom: 3px solid black;">
                <td style="border-right: 3px solid black;">{{ billet.destinationVoyage }}</td>
                <td style="border-right: 3px solid black;">{{ billet.dateDepart|date('Y-m-d H:i:s') }}</td>
                <td style="border-right: 3px solid black;">{{ billet.prix }}</td>
                <td style="border-right: 3px solid black;">{{ billet.duree }}</td>
                <td style="border-right:3px solid black;">{{ billet.station.nomStation }} - {{ billet.station.adressStation }} - {{ billet.station.type }}</td>
                <td style="border-right: 3px solid;">
                    <a href="{{ path('edit_billet',{id: billet.refVoyage}) }}" class="modifier">Modifier</a> <!-- Bouton Modifier -->
                    <br> <!-- Ajout d'un saut de ligne -->
                    <a href="#" class="supprimer" onclick="$('#deleteModal').modal('show'); $('#confirmDelete').attr('href', '{{ path('delete_billet', {id: billet.refVoyage}) }}'); return false;">Supprimer</a> <!-- Bouton Supprimer -->
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table> #}

<!-- Script JavaScript -->




<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#listeBilletsReservesUl').hide();
    $('#afficherListeBillets').click(function() {
     
        $('#listeBilletsReservesUl').toggle(); // Afficher ou masquer la liste des billets réservés
    });
  $('.btn-reserver').click(function() {
    // Récupérer les détails du billet correspondant
    var destination = $(this).closest('.course-item').find('.dest').text().trim();
    var prix = $(this).closest('.course-item').find('.price').text().trim();
    var dateDepart = $(this).closest('.course-item').find('.description').text().trim();
    var duree = $(this).closest('.course-item').find('.trainer-link').text().trim();
  var nomStation = $(this).closest('.course-item').find('h3').attr('data-nom-station');
    var adresseStation = $(this).closest('.course-item').find('h3').attr('data-adresse-station');
    var typeStation = $(this).closest('.course-item').find('h3').attr('data-type-station');
    // Créer un élément HTML pour le billet réservé
    var billetReserveHTML = '<tr>'; // Ouvrir une nouvelle ligne
    billetReserveHTML += '<td>' + destination + '</td>';
    billetReserveHTML += '<td>' + dateDepart + '</td>';
    billetReserveHTML += '<td>' + prix + '</td>';
    billetReserveHTML += '<td>' + duree + '</td>';
    billetReserveHTML += '<td>' + nomStation + ' - ' + adresseStation + ' - ' + typeStation + '</td>'; // Laisser cette colonne vide pour le moment
    billetReserveHTML += '<td><button class="btn-annuler-reservation">Annuler</button></td>'; // Ajout du bouton Annuler
    billetReserveHTML += '</tr>'; // Fermer la ligne

    // Ajouter le billet à la liste en tant qu'élément li
    $('#listeBilletsReserves').append(billetReserveHTML);
});


    // Gestionnaire d'événements click pour les boutons de réservation
    $('.btn-reserver').click(function() {
        // Récupérer le texte actuel du bouton
        var buttonText = $(this).text().trim();

        // Vérifier le texte actuel du bouton
        if (buttonText === "Réserver") {
            // Afficher le bouton Annuler
           
            // Ajouter la classe CSS pour le style rouge
            $(this).addClass("btn-annuler");

            // Incrémenter le nombre de réservations
            var numberOfReservationsElement = $(this).siblings('.bi-person');
            var currentNumberOfReservations = parseInt(numberOfReservationsElement.text().trim());
            if (!isNaN(currentNumberOfReservations)) {
                var newNumberOfReservations = currentNumberOfReservations + 1;
                numberOfReservationsElement.text(newNumberOfReservations);
            }
        } else {
            // Si le texte actuel n'est pas "Réserver", le changer en "Réserver"
            $(this).text("Réserver");
            // Masquer le bouton Annuler
            $(this).siblings('.btn-annuler').hide();

            // Décrémenter le nombre de réservations
            var numberOfReservationsElement = $(this).siblings('.bi-person');
            var currentNumberOfReservations = parseInt(numberOfReservationsElement.text().trim());
            if (!isNaN(currentNumberOfReservations) && currentNumberOfReservations > 0) {
                var newNumberOfReservations = currentNumberOfReservations - 1;
                numberOfReservationsElement.text(newNumberOfReservations);
                if (newNumberOfReservations === 0) {
                    $(this).siblings('.btn-annuler').hide();
                }
            }
        }
    });

});

// Gestionnaire d'événements click pour le bouton Annuler (en dehors de $(document).ready)
$(document).on('click', '.btn-annuler-reservation', function() {
    console.log("Cliqué sur le bouton Annuler");
    // Retirer l'élément li correspondant à ce billet de la liste
    $(this).closest('tr').remove(); // Supprimez l'élément li correspondant

    // Décrémenter le nombre de réservations
    var numberOfReservationsElement = $(this).closest('.trainer-rank').find('.bi-person');
    var currentNumberOfReservations = parseInt(numberOfReservationsElement.text().trim());
    if (!isNaN(currentNumberOfReservations) && currentNumberOfReservations > 0) {
        var newNumberOfReservations = currentNumberOfReservations - 1;
        numberOfReservationsElement.text(newNumberOfReservations);
        if (newNumberOfReservations === 0) {
            $(this).hide(); // Masquer le bouton "Annuler" si le nombre de réservations est de zéro
        }
    }
});
</script>

{% endblock %}
